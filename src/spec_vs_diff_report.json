{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-17T17:16:14.003Z",
  "summary": "Diff introduces new ActorSession/AppReadiness contexts and gates several React Query hooks (parties/payments/today dashboard) behind an “app ready” condition to reduce early data fetching. However, the due-today alert logic appears effectively disabled even after staff login, and there is insufficient evidence that actor initialization is truly deduplicated to once per identity session or that actor-readiness-triggered query churn/invalidation cascades were removed. One change also appears to relax permissions in a way not requested.",
  "missing_requirements": [
    {
      "id": "REQ-51",
      "requirement": "After staff login succeeds, the main screens load data normally and the due-today alert can run without requiring a manual refresh.",
      "reason": "The due-today alert hook is implemented as a no-op that clears state and includes a comment saying it is kept disabled, with no actual fetching/derivation of parties due today even when the app is ready.",
      "evidence": [
        "frontend/src/hooks/useDueTodayAlert.ts"
      ]
    },
    {
      "id": "REQ-52",
      "requirement": "Ensure actor creation/initialization is performed once per Internet Identity principal change and shared across hooks/components; avoid multiple initialization sequences during bootstrap.",
      "reason": "A shared ActorSessionContext is added, but the diff does not include the implementation of useActorSafe (which likely performs actor initialization). Without that code, there is no evidence that initialization is deduplicated per principal change (e.g., caching by principal/identity session) rather than re-running on remounts.",
      "evidence": [
        "frontend/src/context/ActorSessionContext.tsx"
      ]
    },
    {
      "id": "REQ-52",
      "requirement": "Initialization happens once per Internet Identity principal change (not just “authenticated vs not”).",
      "reason": "The context’s \"principalKey\" is set to a constant string 'authenticated' when an actor exists, which does not vary by principal and therefore does not demonstrate correct per-principal session scoping.",
      "evidence": [
        "frontend/src/context/ActorSessionContext.tsx"
      ]
    },
    {
      "id": "REQ-53",
      "requirement": "Avoid broad query invalidation/refetch cascades on actor readiness; only relevant queries refresh when needed.",
      "reason": "While some queries are tuned (staleTime/refetchOnWindowFocus/retry), the diff does not show removal of any existing actor-readiness-driven invalidation/refetch logic (if present), nor does it show a targeted replacement strategy. Additionally, useImportData explicitly invalidates multiple query keys, which may still be acceptable but does not itself evidence fixing actor-readiness cascades.",
      "evidence": [
        "frontend/src/hooks/queries/useAuth.ts",
        "frontend/src/hooks/queries/useTransfer.ts"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Due-today alert functionality appears intentionally disabled (no expensive fetching, no backend query), which is a behavioral/product change not requested and conflicts with keeping the alert working after staff login.",
      "reason": "The hook explicitly states it is kept disabled and does not perform the due-today computation when ready.",
      "evidence": [
        "frontend/src/hooks/useDueTodayAlert.ts"
      ]
    },
    {
      "description": "Relaxed staff permission behavior by assuming \"canViewAllRecords: true\" when listStaffAccounts is unauthorized (non-admin), which may change authorization/permissions semantics.",
      "reason": "BuildRequest non-goal forbids changing authentication/security requirements or relaxing admin-only permissions; the diff introduces an assumption granting broad viewing capability on Unauthorized.",
      "evidence": [
        "frontend/src/hooks/queries/useStaffPermissions.ts"
      ]
    }
  ],
  "confidence": 0.66,
  "changed_files": [
    "frontend-file-summaries.txt",
    "frontend/src/App.tsx",
    "frontend/src/context/ActorSessionContext.tsx",
    "frontend/src/context/AppReadinessContext.tsx",
    "frontend/src/hooks/queries/useAuth.ts",
    "frontend/src/hooks/queries/useBranding.ts",
    "frontend/src/hooks/queries/useParties.ts",
    "frontend/src/hooks/queries/usePayments.ts",
    "frontend/src/hooks/queries/useStaffPermissions.ts",
    "frontend/src/hooks/queries/useTodayDashboard.ts",
    "frontend/src/hooks/queries/useTransfer.ts",
    "frontend/src/hooks/useDueTodayAlert.ts",
    "frontend/src/hooks/useStaffAuth.ts",
    "project_state.json"
  ]
}